---
title: Data Models
description: Database schema and data models for IntrepidQ AI
---

# Data Models and Database Schema

## Database Tables

### user_profiles
Stores user profile information and statistics.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.user_profiles (
    id uuid PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
    username text UNIQUE,
    full_name text,
    preferred_subjects text[] DEFAULT '{}',
    total_questions_generated integer DEFAULT 0,
    total_papers_generated integer DEFAULT 0,
    generation_count_today integer NOT NULL DEFAULT 0,
    last_generation_date date,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: User ID (foreign key to auth.users)
- `username`: Unique username for the user
- `full_name`: User's full name
- `preferred_subjects`: Array of user's preferred subjects
- `total_questions_generated`: Total number of questions generated by the user
- `total_papers_generated`: Total number of papers generated by the user
- `generation_count_today`: Number of questions generated today
- `last_generation_date`: Date of last question generation
- `created_at`: Record creation timestamp
- `updated_at`: Record update timestamp

### generated_questions
Stores all generated questions and their metadata.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.generated_questions (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE NOT NULL,
    subject text NOT NULL CHECK (subject IN ('GS1','GS2','GS3','GS4')),
    topic text,
    mode text NOT NULL CHECK (mode IN ('topic','paper','keyword')),
    questions text NOT NULL,
    use_current_affairs boolean DEFAULT false,
    months integer,
    question_count integer DEFAULT 1,
    model text,
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the generated question set
- `user_id`: User ID (foreign key to auth.users)
- `subject`: UPSC subject (GS1, GS2, GS3, GS4)
- `topic`: Specific topic within the subject
- `mode`: Generation mode (topic, paper, keyword)
- `questions`: Generated questions (JSON format)
- `use_current_affairs`: Whether current affairs were included
- `months`: Number of months of current affairs included
- `question_count`: Number of questions generated
- `model`: AI model used for generation
- `created_at`: Generation timestamp

### usage_analytics
Tracks user actions and system events for analytics.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.usage_analytics (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,
    action text NOT NULL,
    success boolean DEFAULT true,
    error_message text,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the analytics event
- `user_id`: User ID (foreign key to auth.users, optional)
- `action`: Type of action performed
- `success`: Whether the action was successful
- `error_message`: Error message if action failed
- `metadata`: Additional metadata about the action (JSON)
- `created_at`: Event timestamp

### question_feedback
Stores user feedback on generated questions.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.question_feedback (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id uuid REFERENCES auth.users(id) ON DELETE CASCADE,
    question_id uuid REFERENCES generated_questions(id) ON DELETE CASCADE,
    rating integer CHECK (rating >= 1 AND rating <= 5),
    comment text,
    feedback_type text,
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the feedback
- `user_id`: User ID (foreign key to auth.users)
- `question_id`: Question ID (foreign key to generated_questions)
- `rating`: Rating (1-5 stars)
- `comment`: Feedback comment
- `feedback_type`: Type of feedback (bug, feature, general)
- `created_at`: Feedback timestamp

### questions_cache
Caches generated questions to improve performance.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.questions_cache (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    cache_key text UNIQUE NOT NULL,
    subject text NOT NULL,
    topic text,
    questions jsonb NOT NULL,
    metadata jsonb,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the cache entry
- `cache_key`: Hash key for cache lookup
- `subject`: UPSC subject
- `topic`: Specific topic
- `questions`: Cached questions (JSON)
- `metadata`: Cache metadata (JSON)
- `expires_at`: Expiration timestamp
- `created_at`: Creation timestamp

### guest_generations
Tracks question generation by guest users (IP-based).

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.guest_generations (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    ip_address text NOT NULL,
    generation_count integer DEFAULT 0,
    last_generation_date date,
    updated_at timestamp with time zone DEFAULT now(),
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the guest record
- `ip_address`: IP address of the guest user
- `generation_count`: Number of questions generated today
- `last_generation_date`: Date of last generation
- `updated_at`: Last update timestamp
- `created_at`: Record creation timestamp

### model_performance
Tracks AI model performance metrics.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.model_performance (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    model_name text NOT NULL,
    response_time numeric,
    success boolean DEFAULT true,
    error_message text,
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the performance record
- `model_name`: Name of the AI model
- `response_time`: Response time in seconds
- `success`: Whether the call was successful
- `error_message`: Error message if call failed
- `created_at`: Record timestamp

### documents
Stores document embeddings for vector search.

#### Schema
```sql
CREATE TABLE IF NOT EXISTS public.documents (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    content text,
    metadata jsonb,
    embedding vector(1536),
    created_at timestamp with time zone DEFAULT now()
);
```

#### Fields
- `id`: Unique identifier for the document
- `content`: Document content
- `metadata`: Document metadata (JSON)
- `embedding`: Vector embedding
- `created_at`: Document timestamp

## Recent Schema Updates

### Model Column Addition
Added `model` column to the `generated_questions` table:
- Tracks which AI model was used for question generation
- Enables model performance analysis
- Supports model selection optimization

### Feedback Type Column Addition
Added `feedback_type` column to the `question_feedback` table:
- Categorizes feedback as bug, feature, or general
- Enables better feedback organization and analysis
- Improves support ticket routing

### Keyword Mode Support
Extended the `mode` field constraint in `generated_questions`:
- Added 'keyword' as a valid mode value
- Supports keyword-based question generation
- Maintains backward compatibility with existing modes

## Data Relationships

### User Relationships
- `user_profiles.id` → `auth.users.id`
- `generated_questions.user_id` → `auth.users.id`
- `usage_analytics.user_id` → `auth.users.id`
- `question_feedback.user_id` → `auth.users.id`

### Question Relationships
- `generated_questions.id` → `question_feedback.question_id`
- `generated_questions.id` → `answers.question_id`

### Cache Relationships
- `questions_cache` is associated with `generated_questions` through subject/topic

## Indexes

### Performance Indexes
- `idx_generated_questions_user_date`: Index on user_id and created_at for history queries
- `idx_generated_questions_created_at`: Index on created_at for cleanup operations
- `idx_question_feedback_type`: Index on feedback_type for feedback categorization
- `idx_documents_embedding`: Vector index on embedding for similarity search

## Recent Database Migrations

### Migration Files
1. `migration_add_model_column.sql`: Added model column to track AI model usage
2. `migration_add_feedback_type_column.sql`: Added feedback_type column for better feedback categorization
3. `migration_add keyword mode.sql`: Extended mode field to support keyword-based generation

### Migration Process
1. Each migration file can be run independently
2. Migrations are idempotent (safe to run multiple times)
3. Migrations include verification queries to confirm success
4. Migrations maintain backward compatibility